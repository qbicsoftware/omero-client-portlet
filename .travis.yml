# Build script for Travis CI
#

# use xenial distro
dist: xenial

# no need to check for oracle's java
language: java
jdk: openjdk8

# speed up builds by caching maven local repository
cache:
  directories:
  - "$HOME/.m2/repository"

# as agreed in our SOP
branches:
  only:
  - master
  - development

# added to make logs look cleaner, crisper, certified fresh
before_install: unset _JAVA_OPTIONS 

# speed up builds by telling Travis that we don't need any special "installation"
install: true

# check if we need to add a license file for Vaadin charts
before_script: if [ "$VAADIN_CHARTS_LICENSE_CODE" != "" ]; then
                  echo "$VAADIN_CHARTS_LICENSE_CODE" > ~/.vaadin.charts.developer.license;
               fi;

# as agreed in our SOP, build everything (don't deploy, just try to 'mvn install' locally, which covers all phases)
script: mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml clean cobertura:cobertura install
# upload code coverage report, generate maven site (javadocs, documentation, static code analysis, etc.)
after_success: 
- bash <(curl -s https://codecov.io/bash)
- mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml site

# upload to maven
deploy:
  # as agreed in our SOP, builds on development branch will deploy to our maven repository after validating
  # the artifact has a proper SNAPSHOT version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles development-build,!release-build --settings .travis.settings.xml deploy
  on:
    branch: development
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'
  # as agreed in our SOP, tagging a commit on the master branch will upload to our maven repository
  # after validating the artifact has a proper release version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles !development-build,release-build --settings .travis.settings.xml deploy
  on:
    branch: master
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'

# change according to your needs, but we recommend to deactivate email notifications
# for now, we configured Travis to send a notification to the #travis-ci channel 
notifications:
  email:
    on_success: never
    on_failure: never
  slack: 
    on_success: never
    on_failure: always
    # edit the following section if you want to get slack notifications
    rooms:
      - secure: "***"

env:
  global:
  - secure: "dG2gx4FTZeUPy789C1gP/H1yeg3rhTenA0JWRtPyWFNJUmRbFwCPAkm+VdkC9hupC+3VdaL00ZlxJiqJPeoQJFKrvwuNB+ej82b0MD1a6MpiGScFZmMmCVbXyqD6VHgJ7wPt+dN0h+FrKd1ItVQi1exSbroPBTY8dCWS3RBy7ubap5MMMw8ZAaTgpFOdLwcZJ2PTBtvNMjn6Uc1Ps2kN4E1Mw757g01a2fEz9/YWJKCbnYlN6F+U3v7/nZkrG1zBSvZixgaDZklTIt/v4UK3VbAlU/LHOUDpwvPgxQgn+CaA9ZGB0O0NPndlG5Hn99Me/UWfrZHtAy6/+6dBCEwdrNA81jynEJhNsSG1OCmarcm1ptWG65+X+vmDHdQuc0mrdlp8Cx5m04Zng/gTMTECBBQSLkVNlSOE65rwzPHaFu0wpKLY4/2VLwQ6TdNJASOWPXHFIwTCSrPVxqZ2V8R3v1MkC9Ejm3ucBohgeMNpCh3sg0YuEtXdV33omckv5X4O8piDqzX5v9tYnJrDRH3wsd37Lw/ihSzSNhfoo4o2PgrC6WD78HYygVX8YY/T1feONIU7/Mkq7Vgr/LMDpiuCo/Gzew9FAzESr4AMmeK8K8JQWBHFl2XPdyKuYD20t1zvCFZcG8taio0gUohfrmDYZUbtq3PVJ2izB6ywsrCV+vs="
  - secure: "OTuHyHS09V55PFNokxnU/wqYGwDmV4DRxNmNO+IxGzcEKPSFK/Ad7cKNONNUfK+zFPXxmZFNsqlz01msNV1dJbPw4zs6bJ7nmRofluCKjjdrUN3qI7jNJ90rvwWh37F3cuvjA2D+nE9a5+cd92cKlToSgIqYsVN6MQde59ukB6YMk69gSJ39Hm+kFKj2BHHSIgLQNuZVzz2g37B3VRC0HGRKhCsV5KmAykLgEheDVcM1eNm6zqH/nFvSHplDDp+BBkozBg9MsxhL4Adv8Sc1bCJq38FKMohaKkG+1NBONwfAlKk0jZuXn3nariHc9KHbl5h1ZP9R0DB072IJVgXTWVox5pccxKFjl0z+yGzfdAP0gHmS0w3GudAwlBcYQVd79p11HsImr6Xu7eklrtrb3gm0V9cGl7exbZwfHEzomIfDhPqMEGHZfKyINHr28dN4928cX5QNUHAWIyJfP/vLOE44TZTWkc1H+sjiimvfV6vEjPg9NtAR/juANTxadLc2O0YNliqMluvcgLovmFnC8FkiNZCOytC/T5mBpWMyXl6LcO2Isn8Ljrb2xSdO9LXM4a6yGY1Ly82X6XlBPxmgpdeWJUlYUdh7Cy1PXx8FDWCrkSEQqeDz+cnKSXI+0ziSBZFIvhhMQM+f+WcGPtBq1O4E8pOULiwFL+s2X2wsfeA="
